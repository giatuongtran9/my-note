<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" />
        <title>My Note</title>
    </head>

    <body>
        <h1>My Note - Lab 2</h1>
        <p>Welcome to my Notepad</p>

        <div contenteditable="true" id="text"></div>

        <script src="https://unpkg.com/filer/dist/filer.min.js"></script>
        <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
        
        <script>
            const fs = new Filer.FileSystem();

            window.addEventListener('DOMContentLoaded', (event) => {
                console.log('DOM fully loaded and parsed');

                fs.readFile('/note', 'utf8', function(err, data) 
                {
                    var content = document.getElementById("text");
                    if (err)
                    {
                        console.log("Welcome to my notepad!");
                        content.innerHTML = "Nothing here type in something...";
                        console.log(err);
                    }

                    if (data)
                    {
                        console.log("Loaded");
                        content.innerHTML = data;
                    }
                    
                })
            });

            hotkeys.filter = function (event) {
                var tagName = (event.target || event.srcElement).tagName;
                return !(tagName.isContentEditable || tagName == 'INPUT' || tagName == 'SELECT' || tagName == 'TEXTAREA');
            }

            hotkeys("ctrl+s", (event) => {
                event.preventDefault();
                save();
                console.log("Ctrl+s");
            });

            function save() {
                var newString = document.getElementById("text").innerHTML;
                fs.writeFile("/note", newString, (err) => {
                    if (err) {
                        console.log("There is some errors");
                    }
                    else {
                        console.log("Saved ", newString);
                    }
                });
            }
            
        </script>
    </body>
</html>